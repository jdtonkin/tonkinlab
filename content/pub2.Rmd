---
title: "Pub2"
---

Latest update - `r format(Sys.time(), '%d %B, %Y')`




### Published

```{r, results='asis', echo = F, message=F, warning=F}

rm(list = ls())
pacman::p_load(tidyverse,
               scholar,
               stringr,
               magrittr,
               bib2df)

# data --------------------------------------------------------------------

## your google id - can be found in the link bar of your google scholar page
## sid <- "Mtn0TIwAAAAJ"
lab <- c("JD Tonkin")


## get publication list
#pubs <- bibliography_entries("data/MyPubs.bib")

bib_df <- bib2df::bib2df("data/MyPubs.bib", separate_names = FALSE)

# bib_df <- bib_df %>% 
#   mutate(FILE = paste0("data/pdfs/", BIBTEXKEY))
  
# sort bib_df by year
bib_df <- bib_df[order(bib_df$YEAR, decreasing=T),]

# print individual entries to page

for (i in 1:length(bib_df) ){
  t_bib_entry <- paste0(capture.output(df2bib(bib_df[i,])), collapse="")
  t_md_citation<- paste0(stevemisc::print_refs(t_bib_entry,csl = "apa.csl",
                                        spit_out = FALSE,
                                        delete_after = FALSE), collapse=" ")
  cat(t_md_citation)



  cat("<span class = 'publinks'>")

  # if(any(names(bib_df)=="FILE")){
  #   if( !is.na(bib_df[i,"FILE"]) ){
      pdf_url <- paste0("data/pdfs/",bib_df[i,"BIBTEXKEY"], collapse = "")
      cat(c("  ",'<a href="',pdf_url,'"> <i class="fas fa-file-pdf"> pdf </i></a>'),
        sep="")
  #   }
  # }

  if(any(names(bib_df)=="URL_WEBSITE")){
    if( !is.na(bib_df[i,"URL_WEBSITE"]) ){
      pdf_url <- as.character(bib_df[i,"URL_WEBSITE"])
      cat(c("  ",'<a href="',pdf_url,'"> <i class="fas fa-globe"> website </i></a>'),
        sep="")
    }
  }

  if(any(names(bib_df)=="URL_DATA")){
  if( !is.na(bib_df[i,"URL_DATA"]) ){
      pdf_url <- as.character(bib_df[i,"URL_DATA"])
      cat(c("  ",'<a href="',pdf_url,'"> <i class="fas fa-database"> data </i></a>'),
        sep="")
    }
  }

  cat("</span>")
  cat("\n\n")
}

# pubs <- pubs %>%
#   as_tibble() %>%
#   arrange(desc(YEAR)) %>%
#   #transmute(AUTHOR = AUTHOR) %>% 
#   select(AUTHOR, YEAR, TITLE, JOURNAL) %>%
#   transmute(YEAR = YEAR,
#             item = paste0(TITLE, ". ", JOURNAL)) %>%
#   rename_with(.fn = str_to_sentence)
# 
# pubs
# knitr::kable(pubs)


# library(RefManageR)
# BibOptions(max.names = 2, first.inits = TRUE)
# 
# bib <- ReadBib("data/MyPubs.bib", check = FALSE)
# 
# bdf <- as.data.frame(bib)
# 
# bdf %>%
#   as_tibble() %>%
#   arrange(desc(as.numeric(as.character(year)))) %>%
#   #transmute(AUTHOR = AUTHOR) %>% 
#   select(author, year, title, journal) %>%
#   transmute(year = year,
#             item = paste0(author, ". ", title, ". ", journal)) %>%
#   rename_with(.fn = str_to_sentence)
# 
# knitr::kable(bdf)

# 
# ## case modify
# for(i in 1:length(case)) {
#   pubs <- pubs %>% 
#     mutate(Item = str_replace_all(Item, 
#                                   case[i],
#                                   str_to_sentence(case[i])))
# }
# 
# ## mark lab members
# for(i in 1:length(lab)) {
#   pubs <- pubs %>%
#     mutate(Item = str_replace(Item,
#                               pattern = lab[i],
#                               replacement = paste0(lab[i], "*")))
# }

# stevemisc::print_refs("data/MyPubs.bib",
#                       csl = "apa.csl",
#                       spit_out = TRUE,
#                       delete_after = FALSE)


## print
# pubs %>%
#   reactable(searchable = TRUE,
#             pagination = FALSE,
#             columns = list(
#               #YEAR = colDef(maxWidth = 70)
#               # id = colDef(maxWidth = 70)
#               # Cites = colDef(cell = data_bars(pubs,
#               #                                 text_position = "outside-base",
#               #                                 fill_color = viridis::viridis(5)),
#               #                maxWidth = 100)
#               )
#             )
# #             
#pubs
# pubs %>%
#   filter(type == "article-journal") %>% 
#   dplyr::arrange(issued)
```
